<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sign up â€” GCC Control Tower</title>
  <style>
    body{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:linear-gradient(135deg,#071627 0%, #032c44 100%);color:#0f172a;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:480px;background:#fff;padding:20px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.4)}
    label{display:block;margin-bottom:6px;font-size:0.9rem}
    input,select{width:100%;padding:10px;margin-bottom:10px;border-radius:6px;border:1px solid rgba(15,23,42,0.08)}
    button{background:#0593c6;color:#fff;padding:10px 12px;border:none;border-radius:8px;cursor:pointer}
    .muted{font-size:0.9rem;color:#64748b}
  </style>
</head>
<body>
  <div class="card">
    <h2>Sign up</h2>
    <form id="signupForm">
      <label for="signupType">Sign up as</label>
      <select id="signupType" name="signupType" required>
        <option value="customer">Customer</option>
        <option value="employee">Employee</option>
      </select>

      <div id="customerNameWrap">
        <label for="customerName">Customer Name</label>
        <input id="customerName" name="customerName" />
      </div>

      <label for="name">Your name</label>
      <input id="name" name="name" required />

      <label for="email">Official email</label>
      <input id="email" name="email" type="email" required />

      <label for="phone">Phone</label>
      <input id="phone" name="phone" required />

      <label for="country">Country</label>
      <input id="country" name="country" required />

      <label for="place">Place</label>
      <input id="place" name="place" required />

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <button type="submit">Submit for approval</button>
        <div id="msg" class="muted"></div>
      </div>

      <div style="margin-top:10px">
        <a href="/login.html" class="muted">&larr; Back to login</a>
      </div>
    </form>
  </div>

  <script>
    const API_BASE_URL =
      window.location.hostname === 'localhost'
        ? 'http://localhost:4000'
        : 'https://gcc-control-tower-login.onrender.com';
    const signupType = document.getElementById('signupType');
    const customerWrap = document.getElementById('customerNameWrap');
    signupType.addEventListener('change', ()=>{
      if (signupType.value === 'customer') customerWrap.style.display = '';
      else customerWrap.style.display = 'none';
    });
    // init
    if (signupType.value !== 'customer') customerWrap.style.display = 'none';

    const form = document.getElementById('signupForm');
    const msg = document.getElementById('msg');
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.textContent = 'Submitting...';
      const body = {
        signupType: signupType.value,
        customerName: document.getElementById('customerName').value.trim(),
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        country: document.getElementById('country').value.trim(),
        place: document.getElementById('place').value.trim(),
      };
      try{
        const res = await fetch(API_BASE_URL + '/auth/signup',{
          method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)
        });
        const data = await res.json().catch(()=>({}));
        if (res.ok){
          msg.textContent = 'Submitted for approval. You will receive instructions once approved.';
          form.reset();
          return;
        }
        msg.textContent = data.error || 'Failed to submit';
      }catch(err){
        msg.textContent = 'Network error';
      }
    });
  </script>
</body>
</html>